(function(a){jQuery.fn.buildContainers=function(b){return this.each(function(){if(a(this).is("[inited=true]")){return}this.options={containment:"document",elementsPath:"elements/",onCollapse:function(){},onIconize:function(){},onClose:function(){},onResize:function(){},onDrag:function(){},onRestore:function(){},minimizeEffect:"slide",effectDuration:300};a.extend(this.options,b);var d=a(this);d.attr("inited","true");d.attr("iconized","false");d.attr("collapsed","false");d.attr("closed","false");d.attr("options",this.options);d.css({position:"relative"});if(a.metadata){a.metadata.setType("class");if(d.metadata().skin){d.attr("skin",d.metadata().skin)}if(d.metadata().collapsed){d.attr("collapsed",d.metadata().collapsed)}if(d.metadata().iconized){d.attr("iconized",d.metadata().iconized)}if(d.metadata().icon){d.attr("icon",d.metadata().icon)}if(d.metadata().buttons){d.attr("buttons",d.metadata().buttons)}if(d.metadata().content){d.attr("content",d.metadata().content)}if(d.metadata().aspectRatio){d.attr("aspectRatio",d.metadata().aspectRatio)}if(d.metadata().grid){d.attr("grid",d.metadata().grid)}if(d.metadata().gridx){d.attr("gridx",d.metadata().gridx)}if(d.metadata().gridy){d.attr("gridy",d.metadata().gridy)}if(d.metadata().handles){d.attr("handles",d.metadata().handles)}if(d.metadata().dock){d.attr("dock",d.metadata().dock)}if(d.metadata().width){d.attr("width",d.metadata().width)}if(d.metadata().height){d.attr("height",d.metadata().height)}}if(d.attr("content")){d.mb_changeContainerContent(d.attr("content"))}d.addClass(d.attr("skin"));d.find(".n:first").attr("unselectable","on");if(!d.find(".n:first").html()){d.find(".n:first").html("&nbsp;")}d.containerSetIcon(d.attr("icon"),this.options.elementsPath);if(d.attr("buttons")){d.containerSetButtons(d.attr("buttons"),this.options)}d.css({width:"99.9%"});if(d.attr("width")){var c=a.browser.msie?d.attr("width"):d.attr("width")+"px";d.css({width:c})}if(d.attr("height")){d.find(".c:first , .mbcontainercontent:first").css("height",d.attr("height")-d.find(".n:first").outerHeight()-(d.find(".s:first").outerHeight()))}if(d.hasClass("draggable")){d.css({position:"absolute",margin:0});d.find(".n:first").css({cursor:"move"});d.mb_BringToFront();d.draggable({handle:".n:first",delay:0,containment:this.options.containment,stop:function(){var f=a(this).attr("options");if(f.onDrag){f.onDrag(a(this))}}});if(d.attr("grid")||(d.attr("gridx")&&d.attr("gridy"))){var e=d.attr("grid")?[d.attr("grid"),d.attr("grid")]:[d.attr("gridx"),d.attr("gridy")];d.draggable("option","grid",e)}d.bind("mousedown",function(){a(this).mb_BringToFront()})}if(d.hasClass("resizable")){d.containerResize()}if(d.attr("collapsed")=="true"){d.attr("collapsed","false");d.containerCollapse(this.options)}if(d.attr("iconized")=="true"){d.attr("iconized","false");d.containerIconize(this.options)}setTimeout(function(){d.css("visibility","visible")},500)})};jQuery.fn.containerResize=function(){var c=a(this).hasClass("draggable");var b=a(this).attr("handles")?a(this).attr("handles"):"s";var d=a(this).attr("aspectRatio")?a(this).attr("aspectRatio"):false;a(this).resizable({handles:c?"":b,aspectRatio:d,minWidth:350,minHeight:150,iframeFix:true,helper:"mbproxy",start:function(f,g){g.helper.mb_BringToFront()},stop:function(){var h=a(this);var e=h.outerHeight()-a(this).find(".n:first").outerHeight()-(a(this).find(".s:first").outerHeight());a(this).find(".c:first , .mbcontainercontent:first").css({height:e});if(!c&&!a(this).attr("handles")){var g=a(this).attr("width")&&a(this).attr("width")>0?a(this).attr("width"):"99.9%";a(this).css({width:g})}var f=a(this).attr("options");if(f.onResize){f.onResize(a(this))}}});a(this).find(".ui-resizable-n").addClass("mb-resize").addClass("mb-resize-resizable-n");a(this).find(".ui-resizable-e").addClass("mb-resize").addClass("mb-resize-resizable-e");a(this).find(".ui-resizable-w").addClass("mb-resize").addClass("mb-resize-resizable-w");a(this).find(".ui-resizable-s").addClass("mb-resize").addClass("mb-resize-resizable-s");a(this).find(".ui-resizable-se").addClass("mb-resize").addClass("mb-resize-resizable-se")};jQuery.fn.containerSetIcon=function(b,c){if(b&&b!=""){a(this).find(".ne:first").prepend("<img class='icon' src='"+c+"icons/"+b+"' style='position:absolute'/>");a(this).find(".n:first").css({paddingLeft:25})}else{a(this).find(".n:first").css({paddingLeft:0})}};jQuery.fn.containerSetButtons=function(g,f){if(!f){f=a(this).attr("options")}var h=f.elementsPath;var b=a(this);if(g!=""){var e=g.split(",");a(this).find(".ne:first").append("<div class='buttonBar'></div>");for(var d in e){if(e[d]=="c"){a(this).find(".buttonBar:first").append("<img src='"+h+a(this).attr("skin")+"/close.png' class='close'/>");a(this).find(".close:first").bind("click",function(){if(!a.browser.msie){b.fadeOut(f.effectDuration)}else{b.hide()}b.attr("closed","true");if(f.onClose){f.onClose(b)}})}if(e[d]=="m"){a(this).find(".buttonBar:first").append("<img src='"+h+a(this).attr("skin")+"/min.png' class='collapsedContainer'/>");a(this).find(".collapsedContainer:first").bind("click",function(){b.containerCollapse(f)});a(this).find(".n:first").bind("dblclick",function(){b.containerCollapse(f)})}if(e[d]=="p"){a(this).find(".buttonBar:first").append("<img src='"+h+a(this).attr("skin")+"/print.png' class='printContainer'/>");a(this).find(".printContainer:first").bind("click",function(){})}if(e[d]=="i"){a(this).find(".buttonBar:first").append("<img src='"+h+a(this).attr("skin")+"/iconize.png' class='iconizeContainer'/>");a(this).find(".iconizeContainer:first").bind("click",function(){b.containerIconize(f)})}}var c=a.browser.mozilla||a.browser.safari;if(c){a(this).find(".buttonBar:first img").css({opacity:0.5,cursor:"pointer",mozUserSelect:"none",khtmlUserSelect:"none"}).mouseover(function(){a(this).fadeTo(200,1)}).mouseout(function(){if(c){a(this).fadeTo(200,0.5)}})}a(this).find(".buttonBar:first img").attr("unselectable","on")}};jQuery.fn.containerCollapse=function(b){this.each(function(){if(!b){b=a(this).attr("options")}var c=a(this);if(a(this).attr("collapsed")=="false"){c.attr("w",c.outerWidth());c.attr("h",c.outerHeight());if(b.minimizeEffect=="fade"){c.find(".o:first").fadeOut(b.effectDuration,function(){})}else{c.find(".icon:first").hide();c.find(".o:first").slideUp(b.effectDuration,function(){});c.animate({height:c.find(".n:first").outerHeight()+c.find(".s:first").outerHeight()},b.effectDuration,function(){c.find(".icon:first").show()})}c.attr("collapsed","true");c.find(".collapsedContainer:first").attr("src",b.elementsPath+a(this).attr("skin")+"/max.png");c.resizable("disable");if(b.onCollapse){b.onCollapse(c)}}else{if(b.minimizeEffect=="fade"){c.find(".o:first").fadeIn(b.effectDuration,function(){})}else{c.find(".o:first").slideDown(b.effectDuration,function(){});c.find(".icon:first").hide();c.animate({height:c.attr("h")},b.effectDuration,function(){c.find(".icon:first").show()})}if(c.hasClass("resizable")){c.resizable("enable")}c.attr("collapsed","false");c.find(".collapsedContainer:first").attr("src",b.elementsPath+a(this).attr("skin")+"/min.png");c.find(".mbcontainercontent:first").css("overflow","auto")}})};jQuery.fn.containerIconize=function(b){if(!b){b=a(this).attr("options")}return this.each(function(){var d=a(this);d.attr("iconized","true");if(d.attr("collapsed")=="false"){d.attr("h",d.outerHeight())}d.attr("w",d.attr("width")&&d.attr("width")>0?(!d.hasClass("resizable")?d.attr("width"):d.width()):!a(this).attr("handles")?"99.9%":d.width());d.attr("t",d.css("top"));d.attr("l",d.css("left"));d.resizable("disable");var c=0;var e=d.css("top");var f=d;if(d.attr("dock")){f=a("#"+d.attr("dock"));var g=f.find("img").size();c=a("#"+d.attr("dock")).offset().left+(32*g);e=a("#"+d.attr("dock")).offset().top}this.dockIcon=a("<img src='"+b.elementsPath+"icons/"+(d.attr("icon")?d.attr("icon"):"restore.png")+"' class='restoreContainer' width='32'/>").appendTo(f).css("cursor","pointer").hide().attr("contTitle",d.find(".n:first").html()).bind("click",function(){d.attr("iconized","false");if(d.is(".draggable")){d.css({top:a(this).offset().top,left:a(this).offset().left})}else{d.css({left:"auto",top:"auto"})}d.show();if(!a.browser.msie){d.find(".no:first").fadeIn("fast");if(d.attr("collapsed")=="false"){d.animate({height:d.attr("h"),width:d.attr("w"),left:d.attr("l"),top:d.attr("t")},b.effectDuration,function(){d.find(".mbcontainercontent:first").css("overflow","auto");if(d.hasClass("draggable")){d.mb_BringToFront()}});d.find(".c:first , .mbcontainercontent:first").css("height",d.attr("h")-d.find(".n:first").outerHeight()-(d.find(".s:first").outerHeight()))}else{d.animate({height:"60px",width:d.attr("w"),left:d.attr("l"),top:d.attr("t")},b.effectDuration)}}else{d.find(".no:first").show();if(d.attr("collapsed")=="false"){d.css({height:d.attr("h"),width:d.attr("w"),left:d.attr("l"),top:d.attr("t")},b.effectDuration);d.find(".c:first , .mbcontainercontent:first").css("height",d.attr("h")-d.find(".n:first").outerHeight()-(d.find(".s:first").outerHeight()))}else{d.css({height:"60px",width:d.attr("w"),left:d.attr("l"),top:d.attr("t")},b.effectDuration)}}if(d.hasClass("resizable")&&d.attr("collapsed")=="false"){d.resizable("enable")}a(this).remove();if(d.hasClass("draggable")){d.mb_BringToFront()}a(".iconLabel").remove();if(b.onRestore){b.onRestore(d)}}).bind("mouseenter",function(){var h="<div class='iconLabel'>"+a(this).attr("contTitle")+"</div>";a("body").append(h);a(".iconLabel").hide().css({position:"absolute",top:a(this).offset().top-15,left:a(this).offset().left+15,opacity:0.9}).fadeIn("slow").mb_BringToFront()}).bind("mouseleave",function(){a(".iconLabel").remove()});if(!a.browser.msie){d.find(".mbcontainercontent:first").css("overflow","hidden");d.find(".no:first").slideUp("fast");d.animate({height:"32px",width:"32px",left:c,top:e},b.effectDuration,function(){a(this.dockIcon).show();if(d.attr("dock")){d.hide()}})}else{d.find(".no:first").hide();d.css({height:"32px",width:"32px",left:c,top:e});a(this.dockIcon).show();if(d.attr("dock")){d.hide()}}if(b.onIconize){b.onIconize(d)}})};jQuery.fn.mb_resizeTo=function(c,b){if(!b){b=a(this).outerWidth()}if(!c){c=a(this).outerHeight()}a(this).animate({height:c,width:b},500,function(){var d=a(this).outerHeight()-a(this).find(".n:first").outerHeight()-(a(this).find(".s:first").outerHeight());a(this).find(".c:first , .mbcontainercontent:first").animate({height:d})})};jQuery.fn.mb_iconize=function(){if(a(this).attr("closed")=="false"){if(a(this).attr("iconized")=="true"){var b=a(this)[0].dockIcon;a(b).click();a(this).mb_BringToFront()}else{a(this).containerIconize()}}};jQuery.fn.mbOpenBox=function(b,c){if(a(this).attr("closed")=="true"){if(!c){c=""}if(b){a(this).mb_changeContainerContent(b,c)}if(!a.browser.msie){a(this).fadeIn(300)}else{a(this).show()}a(this).attr("closed","false");a(this).mb_BringToFront()}};jQuery.fn.mbCloseBox=function(){if(a(this).attr("closed")=="false"){a(this).find(".close:first").click()}};jQuery.fn.mb_toggle=function(){if(a(this).attr("closed")=="false"&&a(this).attr("iconized")=="false"){a(this).containerCollapse()}};jQuery.fn.mb_BringToFront=function(){var b=10;a("*").each(function(){if(a(this).css("position")=="absolute"){var c=parseInt(a(this).css("zIndex"));b=c>b?parseInt(a(this).css("zIndex")):b}});a(this).css("zIndex",b+=1)};jQuery.fn.mb_changeContent=function(c,d){var b=a(this);if(!d){d=""}a.ajax({type:"POST",url:c,data:d,success:function(e){b.html(e)}})};jQuery.fn.mb_changeContainerContent=function(b,c){a(this).find(".mbcontainercontent:first").mb_changeContent(b,c)};jQuery.fn.mb_getState=function(b){var c=a(this).attr(b);c=c=="true";return c};jQuery.fn.mb_fullscreen=function(){if(!a(this).is(".draggable")||a(this).is("[iconized='true']")||a(this).is("[collapsed='true']")){return}a(this).attr("w",a(this).width());a(this).attr("h",a(this).height());a(this).attr("t",a(this).css("top"));a(this).attr("l",a(this).css("left"));a(this).animate({top:10,left:10,position:"relative"});a(this).mb_resizeTo("98%","98%")}})(jQuery);